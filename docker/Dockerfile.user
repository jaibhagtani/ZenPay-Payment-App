FROM node:20.12.0-alpine3.19

WORKDIR /usr/src/app

COPY package.json package-lock.json turbo.json ./

COPY apps ./apps
COPY packages ./packages

RUN npm install
ENV DATABASE_URL=DATABASE_URL
RUN npm run db:generate

# Accept REDIS_URL as a build argument.
ARG REDIS_URL
# Use the build argument to set the environment variable.
ENV REDIS_URL=REDIS_URL

# Optional: Debug the value (remove in production)
# RUN echo "REDIS_URL = $REDIS_URL"

RUN npm run build

CMD [ "npm", "run", "start-user-app" ]

